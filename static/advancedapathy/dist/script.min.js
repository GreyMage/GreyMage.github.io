!function(){"use strict";function a(a){"loading"!==document.readyState?a():document.addEventListener("DOMContentLoaded",a)}function e(){socket.once("chatMsg",function(){setTimeout(function(){s.loadApathy(),s.loopCheck()},2e3)})}var s={};s.chat=function(a){var e=document.getElementById("chatbuffer"),s=document.createElement("div"),t=document.createElement("div");t.classList.add("message"),t.setAttribute("style","font-size: 0.7em;"),t.innerHTML="<b>** Apathy **</b>: "+a,e.appendChild(s),s.appendChild(t)},s.saveIgnores=function(){var a=s.getList(),e=IGNORELIST;e.forEach(function(e){-1===a.indexOf(e)&&s.chat("Added "+e+" To Apathy")}),a.forEach(function(a){-1===e.indexOf(a)&&s.chat("Removed "+a+" From Apathy")});var t=JSON.stringify(e);localStorage.setItem("apathy",t)},s.getList=function(){var a=localStorage.getItem("apathy")||"[]",e=JSON.parse(a);return e},s.loadApathy=function(){var a=s.getList(),e=document.getElementById("chatlist");a.forEach(function(a){var s=e.getElementsByClassName(a);IGNORELIST.push(a);for(var t=0;t<s.length;t++)s[t].classList.add("ignored")}),s.chat("Loaded Apathy: "+a.join(", "))},s.loopCheck=function(){s.saveIgnores(),setTimeout(function(){s.loopCheck()},1e3)},s._addChatMsg=addChatMsg,s.addChatMsg=function(a,e){whenExists(e,function(e){var s=a.msg.nick,t=a.msg.msg,d=a.msg.metadata,n=a.ghost,p=$("<div/>").appendTo(e).addClass("msg-"+s),o=$("<div/>");if(!IGNORE_GHOST_MESSAGES||!n){-1!=IGNORELIST.indexOf(s)&&(o.style.fontSize="5px"),p.addClass($("#chatlist ."+s).attr("class")),d.graymute&&p.addClass("graymute");var l=s!=NAME&&NAME.length>0&&detectName(NAME,t),i=!1;switch(a.msg.emote){case!1:if(l&&(p.addClass("highlight"),doSqueeNotify(),addNewMailMessage(a.msg.nick,a.msg.msg)),o.addClass("message").appendTo(p),e.data("lastMsgRecvBy")!=s){var r=$("<span/>").addClass("nick").appendTo(o);d.nameflaunt&&r.addClass("flaunt level_"+a.msg.type),0!=d.flair&&null!=d.flair?(r.text(s),$("<div/>").addClass("flair").addClass("flair_"+d.flair).appendTo(r),r.append(":")):r.text(s+":"),i=!0}$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg(t)),e.data("lastMsgRecvBy",s);break;case"act":l&&(p.addClass("highlight"),doSqueeNotify()),o.addClass("message act").appendTo(p),$("<span/>").addClass("nick").appendTo(o).text(s),$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg(t)),i=!0,e.data("lastMsgRecvBy","");break;case"request":o.addClass("message request").appendTo(p),$("<span/>").addClass("nick").appendTo(o).text(s),$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg("requests "+t)),i=!0,e.data("lastMsgRecvBy","");break;case"sweetiebot":l&&(p.addClass("highlight"),doSqueeNotify(),addNewMailMessage(a.msg.nick,a.msg.msg)),o.addClass("message sweetiebot").appendTo(p),$("<span/>").addClass("nick").appendTo(o).text(s+":"),$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg(t)),i=!0,e.data("lastMsgRecvBy","");break;case"spoiler":o.addClass("message spoiler").appendTo(p),$("<span/>").addClass("nick").appendTo(o).text(s+":"),$("<span/>").addClass("spoiltag").appendTo(o).text("SPOILER:"),$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg(t)),i=!0,e.data("lastMsgRecvBy","");break;case"rcv":l&&(p.addClass("highlight"),doSqueeNotify(),addNewMailMessage(a.msg.nick,a.msg.msg)),o.addClass("message rcv").appendTo(p),$("<span/>").addClass("nick").appendTo(o).text(s+":");var g=$("<span/>").addClass("msg").appendTo(o).append(formatChatMsg(t));p.data("oldPlace",g.prev()),p.data("madeAt",(new Date).getTime());var c=$("#chatbuffer").data("rcv");c.unshift(p),i=!0,e.data("lastMsgRecvBy","");break;case"drink":p.addClass("drinkWrap"),p.prev().hasClass("drinkWrap")&&p.css("border-top","0px"),o.addClass("message drink").appendTo(p);var m=$("<tr/>").appendTo($("<table/>").appendTo(o)),h=$('<td width="100%"/>').appendTo(m);$("<span/>").addClass("nick").appendTo(h).text(s+":"),$("<span/>").addClass("msg").appendTo(h).html(t+" drink!"),a.msg.multi>1&&$("<span/>").addClass("multi").appendTo($("<td/>").appendTo(m)).text(a.msg.multi+"x"),e.data("lastMsgRecvBy","");break;case"poll":o.addClass("pollNote").appendTo(p),$("<span/>").appendTo(o).html(s+' has created a new poll: "'+t+'"');break;case"server":console.log(t),o.addClass("server").appendTo(p),$("<span/>").appendTo(o).html(t);break;default:return void dbg("Unknown message type, emote="+a.msg.emote)}for(;$(e).children().length>500;)$(e).children().first().remove();var C=new Date(a.msg.timestamp);if(CHATLIST[s]=C.getTime(),i)var f=addZero(C.getHours()),u=addZero(C.getMinutes()),T=addZero(C.getSeconds()),r=$("<span/>").addClass("timestamp").prependTo(o).text("<"+f+":"+u+":"+T+">");n||notifyNewMsg(d.channel,l,"rcv"==a.msg.emote)}})},addChatMsg=s.addChatMsg,a(e)}();